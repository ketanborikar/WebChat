<script>
    function login() {
        const username = document.getElementById("username").value;
        const password = document.getElementById("password").value;

        fetch("https://webchat-0qcu.onrender.com/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ username, password })
        })
        .then(response => response.json())
        .then(data => {
            if (data.token) {
                localStorage.setItem("jwt", data.token);  // ✅ Store JWT token
                console.log("Stored JWT token:", data.token);  // ✅ Debugging log
                document.getElementById("auth").style.display = "none";
                document.getElementById("chat-container").style.display = "block";
                loadChatPage();
            } else {
                alert("Login failed!");
            }
        });
    }

    function loadChatPage() {
        const token = localStorage.getItem("jwt");
        console.log("Retrieved JWT token:", token);  // ✅ Debugging log
        if (!token) {
            alert("You must log in first!");
            return;
        }

        fetch("https://webchat-0qcu.onrender.com/chat", {
            method: "GET",
            headers: { "Authorization": `Bearer ${token}` }  // ✅ Include JWT token
        })
        .then(response => response.text())
        .then(html => {
            document.getElementById("chat-container").innerHTML = html;
        })
        .catch(() => {
            alert("Session expired! Please log in again.");
            localStorage.removeItem("jwt");
            location.reload();
        });
    }

    window.onload = loadChatPage;
</script>
